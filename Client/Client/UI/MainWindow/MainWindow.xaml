<Window x:Class="Dwarrowdelf.Client.UI.MainWindow"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:local="clr-namespace:Dwarrowdelf.Client"
	xmlns:ui="clr-namespace:Dwarrowdelf.Client.UI"
	Title="Dwarrowdelf" Height="785" Width="1173"
	x:ClassModifier="internal"
	x:Name="mainWindow"
	TextOptions.TextFormattingMode="Display"
	Icon="/Dwarrowdelf.Client;component/Images/MainWindow.png"
	DataContext="{Binding RelativeSource={RelativeSource Self}}">

	<Window.Resources>
		<CollectionViewSource Source="{Binding Data.World.Objects}" x:Key="filterItemsCvs" Filter="FilterItems" />
		<CollectionViewSource Source="{Binding Data.World.Objects}" x:Key="filterLivingsCvs" Filter="FilterLivings" />

		<ui:ObjectIDConverter x:Key="objectIDConverter"/>
		<ui:SymbolAndColorToDrawingConverter x:Key="drawingConverter"/>

		<ContextMenu x:Key="objectSelectorContextMenu">
			<ContextMenu.ItemTemplate>
				<DataTemplate>
					<StackPanel Orientation="Horizontal">

						<Image Width="24" Height="24">
							<Image.Source>
								<DrawingImage>
									<DrawingImage.Drawing>
										<MultiBinding Converter="{StaticResource drawingConverter}">
											<Binding Path="SymbolID" />
											<Binding Path="EffectiveColor" />
										</MultiBinding>
									</DrawingImage.Drawing>
								</DrawingImage>
							</Image.Source>
						</Image>

						<TextBlock Text="{Binding Description}" />
					</StackPanel>
				</DataTemplate>

			</ContextMenu.ItemTemplate>

			<ContextMenu.ItemContainerStyle>
				<Style>
					<!-- <Setter Property="MenuItem.Icon" Value="{Binding Drawing}" /> -->
					<EventSetter Event="MenuItem.Click" Handler="OnObjectSelectContextMenuClick" />
				</Style>
			</ContextMenu.ItemContainerStyle>
		</ContextMenu>
	</Window.Resources>

	<DockPanel>
		<ui:MainWindowToolBar x:Name="mainWindowTools" DockPanel.Dock="Top" />

		<ui:MainWindowStatusBar DockPanel.Dock="Bottom" />

		<Grid>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="1*" />
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="4*" />
				<ColumnDefinition Width="Auto" />
				<ColumnDefinition Width="1*" />
			</Grid.ColumnDefinitions>

			<Grid.RowDefinitions>
				<RowDefinition />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="200" />
			</Grid.RowDefinitions>

			<GridSplitter Grid.Column="1" Grid.RowSpan="2" Width="4" HorizontalAlignment="Center" VerticalAlignment="Stretch" />
			<GridSplitter Grid.Column="3" Grid.RowSpan="2" Width="4" HorizontalAlignment="Center" VerticalAlignment="Stretch" />

			<GridSplitter Grid.Column="2" Grid.Row="1" Height="4" VerticalAlignment="Center" HorizontalAlignment="Stretch" />

			<!-- Object treeview -->
			<DockPanel Grid.Column="0" Grid.Row="0" Grid.RowSpan="3">
				<ComboBox DockPanel.Dock="Top" Name="filteComboBox" SelectedIndex="3">
					<ComboBoxItem Tag="{Binding Data.World.Objects}">All</ComboBoxItem>
					<ComboBoxItem Tag="{Binding Data.World.RootObjects}">Roots</ComboBoxItem>
					<ComboBoxItem Tag="{Binding Source={StaticResource filterItemsCvs}}">Items</ComboBoxItem>
					<ComboBoxItem Tag="{Binding Source={StaticResource filterLivingsCvs}}">Livings</ComboBoxItem>
					<ComboBoxItem Tag="{Binding Data.World.Controllables}">Controllables</ComboBoxItem>
				</ComboBox>

				<TreeView ItemsSource="{Binding Path=SelectedItem.Tag, ElementName=filteComboBox}"
										  HorizontalContentAlignment="Stretch" ScrollViewer.HorizontalScrollBarVisibility="Disabled"
										  VirtualizingStackPanel.IsVirtualizing="True" VirtualizingStackPanel.VirtualizationMode="Standard">
					<TreeView.Resources>
						<ResourceDictionary Source="/UI/TreeViewTemplateDictionary.xaml" />
					</TreeView.Resources>
				</TreeView>
			</DockPanel>


			<!-- MAP -->
			<DockPanel Grid.Column="2" Grid.Row="0">
				<ui:MasterMapControl x:Name="map" />
			</DockPanel>

			<!-- Events -->
			<Grid Grid.Column="2" Grid.Row="2">
				<Grid.ColumnDefinitions>
					<ColumnDefinition />
					<ColumnDefinition Width="200" />
				</Grid.ColumnDefinitions>

				<ListBox Grid.Column="0"
						 ItemsSource="{Binding Data.GameEvents,Mode=OneWay}" SelectionMode="Single" ui:ListBoxExtenders.AutoScrollToEnd="True"
						 ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Visible"
						 SelectionChanged="MessageListBox_SelectionChanged">
					<ListBox.ItemTemplate>
						<DataTemplate>
							<TextBlock Text="{Binding Message}" TextWrapping="WrapWithOverflow" />
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>

				<GroupBox Header="Focus debug" Grid.Column="1" Margin="2">
					<DockPanel>
						<DockPanel.Resources>
							<ui:UIElementToDescConverter x:Key="elemToDescConverter" />
						</DockPanel.Resources>

						<TextBlock DockPanel.Dock="Top" TextWrapping="Wrap" HorizontalAlignment="Center"
								   Text="{Binding FocusedElement, ElementName=mainWindow, Converter={StaticResource elemToDescConverter}}" />

						<Rectangle HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
							<Rectangle.Fill>
								<VisualBrush Visual="{Binding FocusedElement, ElementName=mainWindow}" Stretch="Uniform"/>
							</Rectangle.Fill>
						</Rectangle>

					</DockPanel>
				</GroupBox>
			</Grid>

			<Grid Grid.Column="4" Grid.RowSpan="3">
				<Grid.RowDefinitions>
					<RowDefinition />
					<RowDefinition />
					<RowDefinition />
				</Grid.RowDefinitions>

				<!-- Selection -->
				<ui:DockSelectedControl Grid.Row="0" DataContext="{Binding Path=SelectedTileAreaInfo, ElementName=map, Mode=OneTime}"  Margin="2"/>

				<!-- Hover -->
				<ui:DockHoverControl Grid.Row="1" DataContext="{Binding Path=TileInfo, ElementName=map, Mode=OneTime}"  Margin="2" />

				<!-- Jobs -->
				<GroupBox Header="Jobs" Grid.Row="2" Margin="2" >
					<TreeView Name="jobTreeView" ItemsSource="{Binding Data.Jobs}" BorderThickness="0">
						<TreeView.Resources>
							<ResourceDictionary Source="/UI/JobViewDictionary.xaml" />
						</TreeView.Resources>

						<TreeView.ContextMenu>
							<ContextMenu>
								<MenuItem Tag="Abort" Header="Abort" Click="MenuItem_Click_JobTreeView" />
							</ContextMenu>
						</TreeView.ContextMenu>
					</TreeView>
				</GroupBox>
			</Grid>

		</Grid>

	</DockPanel>

</Window>
